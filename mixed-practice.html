<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Grade 2 Mixed Math Practice</title>
  <style>
    :root { font-size: 16px; }
    body {
      margin: 0;
      font-family: 'Poppins', 'Comic Sans MS', sans-serif;
      background: #f4fbff;
      color: #15324a;
      padding: 24px 16px 60px;
      min-height: 100vh;
    }

    .back-link {
      display: inline-block;
      margin-bottom: 10px;
      color: #1d5c9b;
      text-decoration: none;
      font-weight: bold;
      background: rgba(255,255,255,0.85);
      padding: 6px 14px;
      border-radius: 999px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    h1 {
      text-align: center;
      background: rgba(255,255,255,0.9);
      padding: 12px 18px;
      border-radius: 14px;
      margin: 0 auto;
      max-width: 420px;
      box-shadow: 0 10px 30px rgba(30,64,104,0.12);
    }

    .subnav {
      margin: 14px auto 30px;
      background: rgba(255,255,255,0.85);
      padding: 10px 20px;
      border-radius: 999px;
      width: fit-content;
      display: flex;
      gap: 12px;
      font-size: 0.95rem;
      box-shadow: 0 12px 25px rgba(30,64,104,0.08);
    }

    .subnav a { color: #0f7abf; font-weight: 600; text-decoration: none; }
    .subnav a:hover { text-decoration: underline; }

    #worksheet {
      max-width: 900px;
      margin: 0 auto;
      display: grid;
      gap: 16px;
    }

    .problem {
      background: #fff;
      padding: 18px 20px 20px;
      border-radius: 16px;
      box-shadow: 0 15px 35px rgba(19,46,76,0.08);
      border: 1px solid rgba(15,58,99,0.08);
    }

    .problem h3 {
      margin: 0 0 8px;
      font-size: 1rem;
      color: #0f4b82;
    }

    .prompt {
      font-size: 1.1rem;
      margin-bottom: 12px;
    }

    input, select {
      font-size: 1rem;
      padding: 8px 10px;
      border-radius: 8px;
      border: 2px solid #bad6ff;
      width: min(220px, 100%);
    }

    input.correct { background: #c8f7d2; border-color: #2ecc71; }
    input.incorrect { background: #ffd6d6; border-color: #ff7979; }

    select.correct { background: #c8f7d2; border-color: #2ecc71; }
    select.incorrect { background: #ffd6d6; border-color: #ff7979; }

    .controls {
      margin-top: 26px;
      text-align: center;
    }

    button {
      margin: 8px;
      padding: 12px 22px;
      font-size: 1rem;
      border: none;
      border-radius: 999px;
      background: linear-gradient(130deg,#1fb6ff,#7a5bff);
      color: white;
      cursor: pointer;
      box-shadow: 0 15px 30px rgba(31,182,255,0.35);
    }

    button.secondary {
      background: #ffffff;
      color: #0f4b82;
      border: 2px solid #d3e7ff;
      box-shadow: none;
    }

    .read-btn {
      margin-top: 10px;
      border-radius: 999px;
      border: none;
      padding: 8px 14px;
      background: #edf4ff;
      color: #0f4b82;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 6px 14px rgba(15,58,99,0.08);
    }

    .read-btn:hover { background: #dfeaff; }

    #score {
      text-align: center;
      margin-top: 14px;
      font-size: 1.1rem;
      color: #0d6b41;
    }
  </style>
</head>
<body>
  <a class="back-link" href="./">&larr; Back to Grade 2 Math Sheet Hub</a>
  <h1>Mixed Skills Practice</h1>
  <div class="subnav">
    <span>Want stacked problems?</span>
    <a href="addition-subtraction.html">Go to Addition/Subtraction â†’</a>
  </div>

  <div id="worksheet"></div>

  <div class="controls">
    <button onclick="checkAnswers()">Check Answers</button>
    <button class="secondary" onclick="generateProblems()">New Sheet</button>
  </div>
  <div id="score"></div>

  <script>
    const worksheet = document.getElementById('worksheet');
    const problems = [];

    const comparisonSymbols = ['<', '>', '='];

    function reset() {
      worksheet.innerHTML = '';
      problems.length = 0;
    }

    function addProblem(title, promptHtml, type, answer, speakText) {
      const idx = problems.length;
      const cleanPrompt = speakText ?? stripHtml(promptHtml);
      problems.push({ type, answer, prompt: cleanPrompt });

      const wrapper = document.createElement('article');
      wrapper.className = 'problem';
      wrapper.innerHTML = `
        <h3>${title}</h3>
        <div class="prompt">${promptHtml}</div>
        ${type === 'select'
          ? `<select id="ans${idx}">
              <option value="">Select</option>
              <option value="<"><</option>
              <option value=">">></option>
              <option value="=">=</option>
             </select>`
          : `<input id="ans${idx}" type="text" inputmode="numeric" autocomplete="off" />`
        }
        <button type="button" class="read-btn" data-idx="${idx}">
          <span aria-hidden="true">ðŸ”Š</span> Read it aloud
        </button>`;
      worksheet.appendChild(wrapper);
    }

    function buildSkipCounting() {
      const start = randInt(5, 40);
      const step = [2, 5, 10][randInt(0,2)];
      const sequence = Array.from({ length: 5 }, (_, i) => start + step * i);
      const blankIndex = randInt(1, 3);
      const answer = sequence[blankIndex];
      sequence[blankIndex] = '___';
      const prompt = `Fill in the missing number: ${sequence.join(', ')}`;
      addProblem('Skip Counting', `Fill in the missing number:<br><strong>${sequence.join(', ')}</strong>`, 'input', String(answer), prompt);
    }

    function buildPlaceValue() {
      const tens = randInt(2, 9);
      const ones = randInt(0, 9);
      const answer = tens * 10 + ones;
      const prompt = `Make the number with ${tens} tens and ${ones} ones.`;
      addProblem('Place Value Builder', `Make the number with <strong>${tens}</strong> tens and <strong>${ones}</strong> ones.`, 'input', String(answer), prompt);
    }

    function buildComparison() {
      const a = randInt(12, 98);
      const b = randInt(12, 98);
      let answer = '=';
      if (a > b) answer = '>';
      else if (a < b) answer = '<';
      const prompt = `Choose the symbol: ${a} blank ${b}`;
      addProblem('Compare Numbers', `Choose the symbol: <strong>${a} __ ${b}</strong>`, 'select', answer, prompt);
    }

    function buildWordProblem() {
      const apples = randInt(4, 15);
      const oranges = randInt(3, 12);
      const take = randInt(1, apples - 1);
      const type = Math.random() > 0.5 ? 'add' : 'sub';
      let text, answer;
      if (type === 'add') {
        text = `Maya has ${apples} stickers and gets ${oranges} more. How many stickers now?`;
        answer = apples + oranges;
      } else {
        text = `Leo picks ${apples} apples and gives ${take} away. How many are left?`;
        answer = apples - take;
      }
      addProblem('Story Problem', text, 'input', String(answer), text);
    }

    const clockCanvas = document.createElement('canvas');
    const clockSize = 160;
    clockCanvas.width = clockSize;
    clockCanvas.height = clockSize;
    const clockCtx = clockCanvas.getContext('2d');

    function makeClockImage(hour, minutes) {
      const ctx = clockCtx;
      ctx.clearRect(0, 0, clockSize, clockSize);
      const R = clockSize / 2;
      ctx.save();
      ctx.translate(R, R);

      // face
      ctx.fillStyle = '#ffffff';
      ctx.strokeStyle = '#0f4b82';
      ctx.lineWidth = 4;
      ctx.beginPath();
      ctx.arc(0, 0, R - 4, 0, Math.PI * 2);
      ctx.fill();
      ctx.stroke();

      // hour marks
      ctx.lineWidth = 2;
      for (let i = 0; i < 12; i++) {
        ctx.save();
        ctx.rotate((Math.PI / 6) * i);
        ctx.beginPath();
        ctx.moveTo(0, -(R - 8));
        ctx.lineTo(0, -(R - 18));
        ctx.stroke();
        ctx.restore();
      }

      const hourAngle = ((hour % 12) + minutes / 60) * (Math.PI / 6);
      const minuteAngle = minutes * (Math.PI / 30);

      // hour hand
      ctx.strokeStyle = '#183a63';
      ctx.lineWidth = 6;
      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.lineTo(Math.sin(hourAngle) * (R * 0.5), -Math.cos(hourAngle) * (R * 0.5));
      ctx.stroke();

      // minute hand
      ctx.strokeStyle = '#3498db';
      ctx.lineWidth = 4;
      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.lineTo(Math.sin(minuteAngle) * (R * 0.75), -Math.cos(minuteAngle) * (R * 0.75));
      ctx.stroke();

      // center
      ctx.fillStyle = '#0f4b82';
      ctx.beginPath();
      ctx.arc(0, 0, 4, 0, Math.PI * 2);
      ctx.fill();

      ctx.restore();
      return clockCanvas.toDataURL('image/png');
    }

    function buildClockWithImage() {
      const hour = randInt(1, 12);
      const minutes = [0,5,10,15,20,25,30,35,40,45,50,55][randInt(0,11)];
      const displayMinutes = minutes.toString().padStart(2, '0');
      const answer = `${hour}:${displayMinutes}`;
      const src = makeClockImage(hour, minutes);
      const prompt = `Look at the clock and write the time you see in hh:mm format.`;
      addProblem(
        'Clock Reading',
        `<img src="${src}" alt="Analog clock showing ${hour}:${displayMinutes}" style="width:160px;height:160px;display:block;margin-bottom:10px;"/>Look at the clock and write the time you see in hh:mm format.`,
        'input',
        answer,
        prompt
      );
    }

    function randInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function generateProblems() {
      reset();
      buildSkipCounting();
      buildPlaceValue();
      buildComparison();
      buildWordProblem();
      buildClockWithImage();
      document.getElementById('score').innerText = '';
    }

    function checkAnswers() {
      let correct = 0;
      problems.forEach((prob, idx) => {
        const el = document.getElementById(`ans${idx}`);
        if (!el) return;
        const value = prob.type === 'select' ? el.value : el.value.trim();
        el.classList.remove('correct','incorrect');
        if (String(value) === prob.answer) {
          correct++;
          el.classList.add('correct');
        } else {
          el.classList.add('incorrect');
        }
      });
      document.getElementById('score').innerText = `You got ${correct} out of ${problems.length} correct.`;
    }

    function stripHtml(raw) {
      const tmp = document.createElement('div');
      tmp.innerHTML = raw;
      return tmp.textContent || tmp.innerText || '';
    }

    function speak(text) {
      if (!('speechSynthesis' in window)) {
        alert('Speech synthesis is not supported in this browser.');
        return;
      }
      window.speechSynthesis.cancel();
      const utter = new SpeechSynthesisUtterance(text);
      utter.pitch = 1.05;
      utter.rate = 0.95;
      window.speechSynthesis.speak(utter);
    }

    document.addEventListener('click', (event) => {
      const btn = event.target.closest('.read-btn');
      if (!btn) return;
      const idx = Number(btn.dataset.idx);
      const prob = problems[idx];
      if (prob?.prompt) {
        speak(prob.prompt);
      }
    });

    generateProblems();
  </script>
</body>
</html>
